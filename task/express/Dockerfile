#установим базовый образ,
#на который будет опираться собственный 
FROM node:20.5.1-alpine3.17 

#укажем метаданные 
LABEL version="1.0" mantainer="Ilya Teplinsky"

#установка рабочей директории,
#где будет находиться приложение
WORKDIR /usr/app

#копируем package.json and package-lock.json
COPY package*.json .

#ADD использовать нежелательно, т.к.
#она может автоматичеки открыть архив/перейти по ссылке,
#COPY же просто копирует и всё

#устанавливаем пакетный менеджер для JS
RUN npm install express

#копируем всё с локальной машины в текущей директории
#в рабочую  директорию образа.
#в базовом образе уже указаны юзер и группа node,
#так что сразу установим владельцев на директорию
COPY --chown=node:node . .

#для безопасности функционирования приложения
#лучше работать из под юзера, а не рута.
#в базовой сборке.
#выше уже задали права 
USER node

#тут устанавливаем переменную  окружения JS,
#не вдавался в подробности, но советуют так
ENV NODE_ENV=production

#укажем порт
EXPOSE 3001

#жестко зададим "запускатор" скрипта
ENTRYPOINT ["node"]

#указываем скрипт на запуск
CMD ["server_express.js"]
